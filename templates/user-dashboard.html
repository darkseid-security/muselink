<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuseLink Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="/static/css/user-dashboard.css?v=20251012-mfa-input-fix">
</head>

<body>
    <!-- Flash Messages Container -->
    <div id="flash-messages" class="flash-messages-container"></div>

    <div class="aurora-background">
        <div class="aurora-dot"></div>
        <div class="aurora-dot"></div>
        <div class="aurora-dot"></div>
    </div>

    <div class="dashboard-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">MuseLink</a>
                <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle Sidebar">
                    <svg class="icon-collapse" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <line x1="9" y1="3" x2="9" y2="21" />
                    </svg>
                </button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z" />
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="my-ideas-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>My Ideas</span>
                </a>
                <a href="#" class="nav-item" data-page="create-idea-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3 16.828V21h4.172l14-14.188z M11 5H6a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-5 M9.5 16.5l1-1 M4.5 12.5l1-1" />
                    </svg>
                    <span>Create Idea</span>
                </a>
                <a href="#" class="nav-item" data-page="flowchart-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                    <span>Planner</span>
                </a>
                <a href="#" class="nav-item" data-page="teams-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Teams</span>
                </a>
                <a href="#" class="nav-item" data-page="drive-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Drive</span>
                </a>
                <a href="#" class="nav-item" data-page="messages-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <span>Messages</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="#" class="nav-item" data-page="settings-page">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    <span>Settings</span>
                </a>
                <a href="/logout" class="nav-item" onclick="clearSessionData()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <main class="main-content" id="main-content">
            <header class="main-header">
                <button class="mobile-nav-toggle" id="mobile-nav-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </header>

            <div class="page is-active" id="dashboard-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Dashboard</h1>
                        <p>Welcome back, {{ user.first_name or user.username }}!</p>
                    </div>
                </div>
                <div class="dashboard-actions">
                    <button class="btn btn-primary" id="dashboard-create-new-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Idea
                    </button>
                </div>
                <div class="stats-grid" id="stats-grid"></div>
                <div class="card recent-ideas" style="margin-bottom: 60px;">
                    <h2>Recent Ideas</h2>
                    <div class="ideas-list" id="recent-ideas-list"></div>
                </div>
            </div>

            <div class="page" id="my-ideas-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>My Ideas</h1>
                        <p>Manage all your creative projects in one place.</p>
                    </div>
                </div>
                <div class="card table-container">
                    <table class="ideas-table">
                        <thead>
                            <tr>
                                <th>Idea Title</th>
                                <th>Type</th>
                                <th>Current Status</th>
                                <th>Change Status</th>
                                <th>Team</th>
                                <th>Contributors</th>
                                <th>Created Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="all-ideas-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="page" id="create-idea-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>AI Creative Studio</h1>
                        <p>Generate images, videos, voice, and scripts with AI</p>
                    </div>
                </div>
                
                <div class="ai-studio-tabs">
                    <button class="studio-tab active" data-tab="text">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                        Text & Scripts
                    </button>
                    <button class="studio-tab" data-tab="image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        Images
                    </button>
                    <button class="studio-tab" data-tab="video">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                        Videos
                    </button>
                    <button class="studio-tab" data-tab="voice">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                        Voice
                    </button>
                </div>

                <!-- Text & Scripts Tab -->
                <div class="studio-content active" id="text-studio">
                    <div class="form-container card" style="margin-bottom: 60px;">
                        <form class="idea-form" id="idea-form">
                            <div class="form-section">
                                <h3>Project Details</h3>
                                <div class="form-group">
                                    <label for="project-title">Project Title (minimum 3 characters)</label>
                                    <div class="input-with-icon">
                                        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h10"></path></svg>
                                        <input type="text" id="project-title" name="title" placeholder="e.g., Summer Campaign 2025" required minlength="3" maxlength="200">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="project-type">Content Type</label>
                                    <div class="input-with-icon">
                                        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                                        <select id="project-type" name="type" required>
                                            <option value="">Select type...</option>
                                            <option value="Copywriting">Copywriting</option>
                                            <option value="Script">Script / Screenplay</option>
                                            <option value="Storyboard">Storyboard</option>
                                            <option value="Social Media">Social Media Post</option>
                                            <option value="Email Campaign">Email Campaign</option>
                                            <option value="Blog Post">Blog Post</option>
                                            <option value="Video Script">Video Script</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="project-description">Description</label>
                                    <textarea id="project-description" name="description" rows="3" placeholder="Briefly describe your creative vision..."></textarea>
                                </div>
                            </div>
                            <div class="form-section">
                                <h3>Creative Direction</h3>
                                <div class="form-group">
                                    <label for="brand-voice">Brand Voice & Tone</label>
                                    <textarea id="brand-voice" name="brand_voice" rows="3" placeholder="e.g., Professional yet friendly, witty, inspirational..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="target-audience">Target Audience (minimum 10 characters)</label>
                                    <textarea id="target-audience" name="target_audience" rows="3" placeholder="Who is this for? (demographics, interests, pain points)" required minlength="10"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="key-messages">Key Messages (minimum 10 characters)</label>
                                    <textarea id="key-messages" name="key_messages" rows="4" placeholder="What are the main points you want to communicate?" required minlength="10"></textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="idea-cancel-btn">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                                    Generate Drafts
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Image Generation Tab -->
                <div class="studio-content" id="image-studio">
                    <div class="form-container card">
                        <form class="ai-form" id="image-form">
                            <div class="form-section">
                                <h3>Image Generation</h3>
                                <div class="form-group">
                                    <label for="image-prompt">Describe Your Image</label>
                                    <textarea id="image-prompt" rows="4" placeholder="e.g., A futuristic cityscape at sunset with flying cars, cyberpunk style, vibrant neon colors..." required></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="image-style">Art Style</label>
                                        <select id="image-style">
                                            <option value="realistic">Realistic</option>
                                            <option value="digital-art">Digital Art</option>
                                            <option value="oil-painting">Oil Painting</option>
                                            <option value="watercolor">Watercolor</option>
                                            <option value="anime">Anime</option>
                                            <option value="3d-render">3D Render</option>
                                            <option value="minimalist">Minimalist</option>
                                            <option value="abstract">Abstract</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="image-ratio">Aspect Ratio</label>
                                        <select id="image-ratio">
                                            <option value="1:1">Square (1:1)</option>
                                            <option value="16:9">Landscape (16:9)</option>
                                            <option value="9:16">Portrait (9:16)</option>
                                            <option value="4:3">Standard (4:3)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                                    Generate Images
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Video Generation Tab -->
                <div class="studio-content" id="video-studio">
                    <div class="form-container card">
                        <form class="ai-form" id="video-form">
                            <div class="form-section">
                                <h3>AI Video Generation (Kling v2.5 Turbo Pro)</h3>
                                <p class="form-description" style="color: var(--text-secondary); margin-bottom: 1rem;">
                                    Generate professional AI videos from text prompts. Takes 60-90 seconds to create.
                                </p>
                                <div class="form-group">
                                    <label for="video-prompt">Video Concept <span style="color: #f56565;">*</span></label>
                                    <textarea id="video-prompt" rows="5" placeholder="e.g., A cinematic time-traveling barista pours a glowing cosmic latte, and as the liquid spirals, reality fractures into alternate dimensions..." required minlength="10" maxlength="2000"></textarea>
                                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Describe the scene, action, camera movement, lighting, and style in detail.</small>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="video-duration">Duration</label>
                                        <select id="video-duration">
                                            <option value="5">5 seconds</option>
                                            <option value="10" selected>10 seconds</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="video-aspect-ratio">Aspect Ratio</label>
                                        <select id="video-aspect-ratio">
                                            <option value="16:9" selected>Landscape (16:9)</option>
                                            <option value="9:16">Portrait (9:16)</option>
                                            <option value="1:1">Square (1:1)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="video-cfg-scale">Quality/Precision (CFG Scale)</label>
                                    <select id="video-cfg-scale">
                                        <option value="0.5">Creative (Lower Quality)</option>
                                        <option value="0.7" selected>Balanced (Recommended)</option>
                                        <option value="0.9">Precise (Higher Quality)</option>
                                    </select>
                                    <small style="color: var(--text-secondary); font-size: 0.85rem;">Higher values follow the prompt more closely and produce better quality.</small>
                                </div>
                                <div class="form-group">
                                    <label for="video-negative-prompt">Negative Prompt (Optional)</label>
                                    <textarea id="video-negative-prompt" rows="2" placeholder="Things to avoid (e.g., blur, distortion, low quality...)" maxlength="1000"></textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('video-form').reset()">Clear</button>
                                <button type="submit" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                                    Generate Video (60-90s)
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Voice Generation Tab -->
                <div class="studio-content" id="voice-studio">
                    <div class="form-container card">
                        <form class="ai-form" id="voice-form">
                            <div class="form-section">
                                <h3>Voice Generation</h3>
                                <div class="form-group">
                                    <label for="voice-text">Text to Speak</label>
                                    <textarea id="voice-text" rows="6" placeholder="Enter the text you want to convert to speech..." required></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="voice-type">Voice Type</label>
                                        <select id="voice-type">
                                            <option value="male-professional">Male - Professional</option>
                                            <option value="female-professional">Female - Professional</option>
                                            <option value="male-casual">Male - Casual</option>
                                            <option value="female-casual">Female - Casual</option>
                                            <option value="male-narrator">Male - Narrator</option>
                                            <option value="female-narrator">Female - Narrator</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="voice-speed">Speed</label>
                                        <select id="voice-speed">
                                            <option value="0.75">Slow</option>
                                            <option value="1.0" selected>Normal</option>
                                            <option value="1.25">Fast</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                                    Generate Voice
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>

            <div class="page" id="draft-results-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1 id="results-page-title">Generated Drafts</h1>
                        <p>Here are some AI-powered starting points. Select one to refine or regenerate.</p>
                    </div>
                </div>
                <div class="results-grid" id="results-grid-container"></div>
            </div>

            <div class="page" id="refine-editor-page" data-idea-id="">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1 id="refine-page-title">Refine Idea</h1>
                        <p>Add your human touch. Polish the content and save the final version.</p>
                    </div>
                </div>
                <div class="editor-container">
                    <textarea id="refine-textarea" class="refine-textarea" rows="20"></textarea>
                    <div class="editor-actions">
                        <button class="btn btn-secondary" id="view-versions-btn">View Version History</button>
                        <button class="btn btn-primary" id="save-final-idea-btn">Save New Version</button>
                    </div>
                </div>
            </div>

            <div class="page" id="teams-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Teams</h1>
                        <p>Collaborate with your colleagues on creative projects.</p>
                    </div>
                </div>
                <div class="teams-layout">
                    <div class="teams-panel-left card">
                        <div class="teams-list-container">
                            <h3>My Teams</h3>
                            <ul class="teams-list" id="teams-list"></ul>
                        </div>

                        <!-- Pending Invitations Section -->
                        <div class="pending-invitations-container" id="pending-invitations-container" style="display: none;">
                            <h3>Pending Invitations</h3>
                            <ul class="invitations-list" id="invitations-list"></ul>
                        </div>

                        <div class="create-team-container">
                            <h3>Create New Team</h3>
                            <form id="create-team-form" class="create-team-form">
                                <div class="form-group">
                                    <label for="team-name" class="sr-only">Team Name</label>
                                    <input type="text" id="team-name" placeholder="e.g., Marketing Crew" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-full">Create Team</button>
                            </form>
                        </div>
                    </div>
                    <div class="teams-panel-right card" id="team-details-panel">
                        <div id="team-details-placeholder">
                            <p>Select a team to see details.</p>
                        </div>
                        <div id="team-details-content" class="hidden">
                            <div class="team-header">
                                <h2 id="selected-team-name"></h2>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <button class="btn btn-primary" id="start-team-call-btn" style="display: none; padding: 0.5rem 1rem; font-size: 0.875rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                        </svg>
                                        Call
                                    </button>
                                    <button class="btn btn-primary" id="invite-member-btn" onclick="openInviteModal()" style="display: none; padding: 0.5rem 1rem; font-size: 0.875rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M22 11h-4"></path>
                                            <path d="M20 9v4"></path>
                                        </svg>
                                        Invite
                                    </button>
                                </div>
                            </div>
                            <p id="selected-team-description" style="color: #999; margin-bottom: 20px;"></p>

                            <div class="team-section">
                                <h3>Team Members</h3>
                                <ul class="team-members-list" id="team-members-list"></ul>
                            </div>

                            <div class="team-ideas-container">
                                <h3>Team Ideas</h3>
                                <div class="ideas-list" id="team-ideas-list"></div>
                            </div>

                            <div class="team-flowcharts-container" style="margin-top: 30px;">
                                <h3>Team Flowcharts</h3>
                                <div class="flowcharts-grid" id="team-flowcharts-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="drive-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Drive</h1>
                        <p id="drive-breadcrumb">Your secure storage for brand assets, notes, and files.</p>
                    </div>
                </div>
                <div class="drive-layout">
                    <div class="drive-sidebar card">
                        <h3>My Drive</h3>
                        <ul class="folder-list" id="my-drive-list"></ul>

                        <!-- Storage Usage Indicator -->
                        <div class="storage-usage-container">
                            <div class="storage-usage-header">
                                <span class="storage-usage-label">Storage</span>
                                <span class="storage-usage-text" id="storage-usage-text">-- MB / 50 MB</span>
                            </div>
                            <div class="storage-usage-bar">
                                <div class="storage-usage-fill" id="storage-usage-fill" style="width: 0%;"></div>
                            </div>
                        </div>

                        <h3 class="team-drive-header">Team Drives</h3>
                        <ul class="folder-list" id="team-drives-list"></ul>
                    </div>
                    <div class="drive-main">
                        <div class="drive-actions">
                            <button class="btn btn-secondary" id="create-folder-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z">
                                    </path>
                                    <line x1="12" y1="10" x2="12" y2="16"></line>
                                    <line x1="9" y1="13" x2="15" y2="13"></line>
                                </svg>
                                Create Folder
                            </button>
                            <button class="btn btn-secondary" id="upload-file-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Upload File
                            </button>
                            <input type="file" id="file-upload-input" style="display: none;" multiple>
                            <button class="btn btn-primary" id="create-note-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="13" x2="12" y2="13"></line>
                                    <line x1="12" y1="17" x2="12" y2="17"></line>
                                </svg>
                                Create Note
                            </button>
                        </div>
                        <p class="upload-note">Maximum file size: 10MB.</p>
                        <div class="files-grid" id="files-grid"></div>
                    </div>
                </div>
            </div>

            <div class="page" id="messages-page" style="margin-bottom: 60px;">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Messages</h1>
                        <p>Secure, end-to-end encrypted communication with your team.</p>
                    </div>
                </div>
                <div class="chat-layout">
                    <div class="chat-sidebar card">
                        <div id="conversation-list">
                            </div>
                    </div>
                    <div class="chat-main card" id="chat-main-panel">
                        <div id="chat-placeholder">
                            <p>Select a conversation to start messaging.</p>
                        </div>
                        <div id="chat-view" class="hidden">
                            <div class="chat-header">
                                <div class="chat-header-info">
                                    <h3 id="chat-title"></h3>
                                    <p id="chat-subtitle"></p>
                                </div>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <button class="btn btn-primary" id="start-conversation-btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.5rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 20h9"></path>
                                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                                        </svg>
                                        New
                                    </button>
                                    <button class="btn btn-primary" id="start-video-call-btn" onclick="showVideoCallComingSoon()" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: none; align-items: center; gap: 0.5rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                        </svg>
                                        Call
                                    </button>
                                </div>
                            </div>
                            <div class="chat-messages" id="chat-messages-list">
                                </div>
                            <div class="chat-input-area">
                                <div id="chat-attachments-preview" class="chat-attachments-preview"></div>
                                <form class="chat-input-form" id="chat-input-form">
                                    <div class="chat-input-wrapper">
                                        <input type="text" id="chat-message-input" placeholder="Type a secure message..." required autocomplete="off">
                                        <button type="button" id="chat-attach-btn" title="Attach Files">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                                        </button>
                                        <input type="file" id="chat-file-input" multiple style="display: none;">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Planner Page -->
            <div class="page" id="flowchart-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Project Planner</h1>
                        <p>Plan creative projects, storyboards, and product designs with AI-powered visual drafts</p>
                    </div>
                </div>

                <!-- Project Action Buttons -->
                <div class="flowchart-actions-bar">
                    <button class="btn btn-secondary" id="flowchart-list-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                        My Projects
                    </button>
                    <button class="btn btn-primary" id="new-flowchart-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        New Project
                    </button>
                </div>

                <!-- Flowchart Editor View -->
                <div class="flowchart-editor-container" id="flowchart-editor-view" style="display: none;">
                    <div class="flowchart-editor-header card">
                        <button class="btn btn-secondary btn-sm" id="back-to-flowcharts">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"></line>
                                <polyline points="12 19 5 12 12 5"></polyline>
                            </svg>
                            Back
                        </button>
                        <input type="text" id="flowchart-title-input" class="flowchart-title-input" placeholder="Untitled Project">
                        <div class="flowchart-actions">
                            <button class="btn btn-secondary btn-sm" id="save-flowchart-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                Save
                            </button>
                            <button class="btn btn-secondary btn-sm" id="export-flowchart-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Export PNG
                            </button>
                        </div>
                    </div>

                    <div class="flowchart-workspace" style="margin-top: 15px;">
                        <!-- Template Sidebar -->
                        <div class="flowchart-sidebar card">
                            <h3>Project Templates</h3>
                            <div class="template-list">
                                <button class="template-item" data-template="storyboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                        <line x1="8" y1="21" x2="16" y2="21"></line>
                                        <line x1="12" y1="17" x2="12" y2="21"></line>
                                    </svg>
                                    <span>Storyboard</span>
                                </button>
                                <button class="template-item" data-template="productRoadmap">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="20" x2="12" y2="10"></line>
                                        <line x1="18" y1="20" x2="18" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="16"></line>
                                    </svg>
                                    <span>Product Roadmap</span>
                                </button>
                                <button class="template-item" data-template="creativeWorkflow">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m-5.905 5.905l-4.243 4.243M1 12h6m6 0h6m-15.196 5.196l4.243-4.243m5.905-5.905l4.243-4.243"></path>
                                    </svg>
                                    <span>Creative Workflow</span>
                                </button>
                                <button class="template-item" data-template="videoProduction">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                    </svg>
                                    <span>Video Production</span>
                                </button>
                                <button class="template-item" data-template="contentPipeline">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    <span>Content Pipeline</span>
                                </button>
                                <button class="template-item" data-template="marketingCampaign">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 11l18-5v12L3 14v-3z"></path>
                                        <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path>
                                    </svg>
                                    <span>Marketing Campaign</span>
                                </button>
                                <button class="template-item" data-template="characterDev">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    <span>Character Development</span>
                                </button>
                                <button class="template-item" data-template="blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    </svg>
                                    <span>Blank Canvas</span>
                                </button>
                            </div>
                        </div>

                        <!-- Canvas Area -->
                        <div class="flowchart-canvas card">
                            <div id="flowchart-container" class="flowchart-render-area"></div>
                        </div>

                        <!-- AI Assistant Panel -->
                        <div class="flowchart-properties card">
                            <!-- Tab Navigation -->
                            <div class="ai-panel-tabs">
                                <button class="ai-panel-tab active" data-tab="generator">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                                    AI Generate
                                </button>
                                <button class="ai-panel-tab" data-tab="suggestions">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                    Suggestions
                                </button>
                                <button class="ai-panel-tab" data-tab="optimizer">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    Optimize
                                </button>
                            </div>

                            <!-- AI Generator Tab -->
                            <div class="ai-panel-content active" id="ai-generator-panel">
                                <h3 style="margin-top: 0;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px; color: #a78bfa;">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                                    AI Flowchart Generator
                                </h3>
                                <p style="font-size: 13px; color: #8b7fa8; margin-bottom: 16px;">Describe your workflow in plain English and let AI create it for you.</p>

                                <div class="property-group">
                                    <label>Project Description</label>
                                    <textarea id="ai-workflow-description" placeholder="Example: Create a video production workflow for a 30-second commercial with pre-production, shooting, editing, and distribution phases..." rows="5"></textarea>
                                </div>

                                <button class="btn btn-primary" id="ai-generate-workflow-btn" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                    Generate Workflow
                                </button>

                                <div id="ai-generate-status" style="margin-top: 12px; font-size: 12px; color: #a78bfa; min-height: 18px;"></div>
                            </div>

                            <!-- Smart Suggestions Tab -->
                            <div class="ai-panel-content" id="ai-suggestions-panel">
                                <h3 style="margin-top: 0;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px; color: #a78bfa;">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                    Smart Suggestions
                                </h3>
                                <p style="font-size: 13px; color: #8b7fa8; margin-bottom: 16px;">AI-powered recommendations for your workflow.</p>

                                <button class="btn btn-secondary" id="ai-get-suggestions-btn" style="width: 100%;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    Get AI Suggestions
                                </button>

                                <div id="ai-suggestions-list" style="margin-top: 16px;">
                                    <!-- Suggestions will be populated here -->
                                </div>
                            </div>

                            <!-- Workflow Optimizer Tab -->
                            <div class="ai-panel-content" id="ai-optimizer-panel">
                                <h3 style="margin-top: 0;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px; color: #a78bfa;">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    Workflow Optimizer
                                </h3>
                                <p style="font-size: 13px; color: #8b7fa8; margin-bottom: 16px;">Analyze and improve your workflow efficiency.</p>

                                <button class="btn btn-secondary" id="ai-optimize-workflow-btn" style="width: 100%;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    Optimize Workflow
                                </button>

                                <div id="ai-optimization-results" style="margin-top: 16px;">
                                    <!-- Optimization results will be shown here -->
                                </div>
                            </div>

                            <!-- Quick Actions (always visible at bottom) -->
                            <div class="ai-quick-actions-panel">
                                <h4 style="font-size: 12px; color: #8b7fa8; margin: 16px 0 8px 0; text-transform: uppercase; letter-spacing: 0.5px;">Quick Actions</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <button class="ai-quick-action-btn" id="ai-improve-current">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M8 12h8"></path>
                                            <path d="M12 8v8"></path>
                                        </svg>
                                        Improve This Workflow
                                    </button>
                                    <button class="ai-quick-action-btn" id="ai-from-idea">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                        </svg>
                                        Generate from Idea
                                    </button>
                                    <button class="ai-quick-action-btn" id="ai-add-checkpoint">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        Add Quality Checkpoints
                                    </button>
                                </div>
                            </div>

                            <!-- Properties (collapsible) -->
                            <details style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(102, 126, 234, 0.2);">
                                <summary style="cursor: pointer; font-weight: 600; color: #e8e6f0; font-size: 14px; margin-bottom: 12px;">Project Properties</summary>
                                <div class="property-group">
                                    <label>Description / Notes</label>
                                    <textarea id="flowchart-description" placeholder="Add a description, notes, or additional details..." rows="3"></textarea>
                                </div>
                                <div class="property-group">
                                    <label>
                                        Edit Mermaid Code
                                        <button type="button" id="apply-mermaid-code-btn" class="btn btn-sm" style="float: right; padding: 4px 12px; font-size: 11px;">Apply Changes</button>
                                    </label>
                                    <textarea id="flowchart-code-editor" placeholder="Mermaid.js code will appear here..." rows="8" style="font-family: 'Courier New', monospace; font-size: 12px;"></textarea>
                                </div>
                                <div class="property-group">
                                    <label>Status</label>
                                    <select id="flowchart-status">
                                        <option value="draft">Draft</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="review">Review</option>
                                        <option value="completed">Completed</option>
                                        <option value="archived">Archived</option>
                                    </select>
                                </div>
                                <div class="property-group">
                                    <label>Team</label>
                                    <select id="flowchart-team">
                                        <option value="">Personal</option>
                                        <!-- Teams will be populated dynamically -->
                                </select>
                            </div>
                            <div class="property-group">
                                <label>
                                    <input type="checkbox" id="flowchart-pinned">
                                    Pin this flowchart
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Node Notes Modal -->
                <div id="node-notes-modal-overlay" class="modal-overlay" style="display: none;">
                    <div id="node-notes-modal" class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <span id="node-notes-title">Add Note</span>
                            </h3>
                            <button class="modal-close" onclick="closeNodeNotesModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                <strong>Node:</strong> <span id="node-notes-node-name" style="color: var(--accent-purple);"></span>
                            </p>
                            <div class="form-group">
                                <label for="node-notes-textarea">Note</label>
                                <textarea
                                    id="node-notes-textarea"
                                    placeholder="Add notes, ideas, or instructions for this step..."
                                    rows="8"
                                    style="width: 100%; padding: 0.75rem; background: var(--bg-secondary); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: var(--text-primary); font-family: inherit; resize: vertical;"
                                ></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeNodeNotesModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveNodeNote()" style="margin-left: 0.5rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Save Note
                            </button>
                        </div>
                    </div>
                </div><!-- Close modal-overlay -->

                <!-- Flowchart List View -->
                <div class="flowchart-list-container" id="flowchart-list-view" style="margin-top: 30px; ">
                    <div class="card">
                        <div class="flowchart-grid" id="flowchart-grid">
                            <!-- Flowcharts will be loaded here dynamically -->
                           <div class="flowchart-empty-state">
                                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <h3>No projects yet</h3>
                                <p>Start planning your creative project with AI-powered drafts. Use templates for storyboards, product roadmaps, or creative workflows.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="settings-page">
                <div class="page-header">
                    <div class="page-header-info">
                        <h1>Settings</h1>
                        <p>Manage your account, security, and creative preferences.</p>
                    </div>
                </div>
                <div class="settings-container">
                    <div class="setting-card card">
                        <h3>Change Password</h3>
                        <p class="setting-description">Password must be at least 14 characters with uppercase, lowercase, number, and special character</p>
                        <form id="change-password-form" class="settings-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                    <input type="password" id="current-password" name="current_password" placeholder="Enter current password" required minlength="8" autocomplete="current-password">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
                                    <input type="password" id="new-password" name="new_password" placeholder="Enter new password (min 14 chars)" required minlength="14" autocomplete="new-password">
                                </div>
                                <div id="password-strength" class="password-strength" style="display: none; margin-top: 0.5rem;">
                                    <div class="strength-bar">
                                        <div class="strength-bar-fill" id="strength-bar-fill"></div>
                                    </div>
                                    <span class="strength-text" id="strength-text"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
                                    <input type="password" id="confirm-password" name="confirm_password" placeholder="Re-enter new password" required minlength="14" autocomplete="new-password">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                    <div class="setting-card card">
                        <h3>Multi-Factor Authentication (MFA)</h3>
                        <p class="setting-description">Add an extra layer of security to your account</p>
                        <div class="mfa-toggle">
                            <span>Enable MFA</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="mfa-toggle-checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="setting-card card">
                        <h3>Change Email Address</h3>
                        <p class="setting-description">Update your email address. You must verify your password for security.</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                            <strong>Current email:</strong> {{ user.email }}
                        </p>
                        <form id="change-email-form" class="settings-form">
                            <div class="form-group">
                                <label for="new-email">New Email Address</label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                    <input type="email" id="new-email" name="new_email" placeholder="Enter new email address" required autocomplete="off">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email-change-password">Current Password (Required)</label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                    <input type="password" id="email-change-password" name="password" placeholder="Verify your password" required minlength="8" autocomplete="current-password">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Email Address</button>
                        </form>
                    </div>
                    <div class="setting-card card">
                        <h3>API Keys Configuration</h3>
                        <p class="setting-description">Manage your personal API keys for Gemini AI and AIMLAPI services. Keys are double-encrypted and stored securely.</p>
                        <div id="api-keys-status" style="margin-bottom: 1rem; padding: 0.75rem; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <svg id="gemini-status-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                <span><strong>Google Gemini API:</strong> <span id="gemini-status">Checking...</span></span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <svg id="aimlapi-status-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                <span><strong>AIMLAPI:</strong> <span id="aimlapi-status">Checking...</span></span>
                            </div>
                        </div>
                        <form id="api-keys-form" class="settings-form">
                            <div class="form-group">
                                <label for="gemini-api-key">
                                    Google Gemini API Key
                                    <a href="https://aistudio.google.com" target="_blank" rel="noopener noreferrer" style="margin-left: 0.5rem; color: var(--accent-color); text-decoration: none; font-size: 0.85rem;">
                                        Get API Key 
                                    </a>
                                </label>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                    <input type="password" id="gemini-api-key" name="gemini_api_key" placeholder="Enter your Gemini API key" autocomplete="off">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="aimlapi-key">
                                    AIMLAPI Key
                                    <a href="https://aimlapi.com/" target="_blank" rel="noopener noreferrer" style="margin-left: 0.5rem; color: var(--accent-color); text-decoration: none; font-size: 0.85rem;">
                                        Get API Key 
                                    </a>
                                </label>
                                <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0.5rem;">
                                    Note: AIMLAPI is a pay-as-you-go service. You'll need to create an account and add credit ($20 recommended).
                                </p>
                                <div class="input-with-icon">
                                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                    <input type="password" id="aimlapi-key" name="aimlapi_key" placeholder="Enter your AIMLAPI key" autocomplete="off">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save API Keys</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="view-content-modal">
            <div class="modal-header">
                <h2 id="view-content-title"></h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body" id="view-content-body"></div>
        </div>
    </div>

    <!-- Note Modal -->
    <div class="modal-overlay" id="note-modal-overlay">
        <div class="modal" id="note-modal">
            <div class="modal-header">
                <h2>Create New Note</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-note-form">
                    <div class="form-group">
                        <label for="note-title">Note Title</label>
                        <input type="text" id="note-title" placeholder="My Brilliant Idea" required>
                    </div>
                    <div class="form-group">
                        <label for="note-content">Content</label>
                        <textarea id="note-content" rows="10" placeholder="Start writing..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Note</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Folder Modal -->
    <div class="modal-overlay" id="folder-modal-overlay">
        <div class="modal" id="folder-modal">
            <div class="modal-header">
                <h2>Create New Folder</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-folder-form">
                    <div class="form-group">
                        <label for="folder-name">Folder Name</label>
                        <input type="text" id="folder-name" placeholder="e.g., Campaign Assets" required>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Folder</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div class="modal-overlay" id="file-preview-modal-overlay">
        <div class="modal modal-large" id="file-preview-modal">
            <div class="modal-header">
                <h2 id="file-preview-title">File Preview</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body" id="file-preview-content">
                <div class="file-preview-container">
                    <img id="file-preview-image" style="max-width: 100%; max-height: 70vh; display: none;" alt="File preview">
                    <div id="file-preview-text" style="white-space: pre-wrap; font-family: monospace; max-height: 70vh; overflow-y: auto; display: none;"></div>
                    <iframe id="file-preview-pdf" style="width: 100%; height: 70vh; border: none; display: none;"></iframe>
                    <div id="file-preview-csv" style="max-height: 70vh; overflow: auto; display: none;">
                        <table class="ideas-table" id="csv-preview-table"></table>
                    </div>
                    <div id="file-preview-unsupported" style="display: none; text-align: center; padding: 2rem;">
                        <p>Preview not available for this file type.</p>
                        <p style="color: var(--text-secondary); margin-top: 0.5rem;">Download the file to view it.</p>
                        <button class="btn btn-primary" id="download-from-preview" style="margin-top: 1rem;">Download File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Folder Contents Modal -->
    <div class="modal-overlay" id="folder-contents-modal-overlay">
        <div class="modal modal-large" id="folder-contents-modal">
            <div class="modal-header">
                <h2 id="folder-contents-title">Folder Contents</h2>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="btn btn-primary" id="upload-to-folder-btn" style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        Upload File to Folder
                    </button>
                    <button class="close-modal-btn">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="folder-contents-grid" class="files-grid"></div>
            </div>
        </div>
    </div>

        <div class="modal" id="version-history-modal">
            <div class="modal-header">
                <h2>Version History</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body version-history-layout">
                <div class="version-list-panel">
                    <h4>Versions</h4>
                    <ul id="version-list"></ul>
                </div>
                <div class="version-preview-panel">
                    <h4>Preview</h4>
                    <pre id="version-preview-content">Select a version to preview its content.</pre>
                    <div class="modal-actions">
                        <button id="restore-version-btn" class="btn btn-primary" disabled>Restore this Version</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="save-version-modal">
            <div class="modal-header">
                <h2>Save New Version</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="save-version-form">
                    <div class="form-group">
                        <label for="version-description">Describe your changes (optional)</label>
                        <input type="text" id="version-description"
                            placeholder="e.g., Refined the intro and added a CTA">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Version</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal" id="manage-contributors-modal">
            <div class="modal-header">
                <h2 id="contributors-modal-title">Manage Contributors</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Current Contributors</h4>
                <ul id="contributors-list-modal" class="contributors-list-modal"></ul>
                <form id="add-contributor-form" class="add-contributor-form">
                    <h4>Add New Contributor</h4>
                    <div class="form-group">
                        <label for="contributor-user">Select User</label>
                        <div class="select-wrapper">
                            <select id="contributor-user" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contributor-role">Assign Role</label>
                        <div class="select-wrapper">
                            <select id="contributor-role" required>
                                <option value="editor">Editor</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary close-modal-btn">Done</button>
                        <button type="submit" class="btn btn-primary">Add Contributor</button>
                    </div>
                </form>
            </div>
        </div>

    <!-- Start Conversation Modal -->
    <div class="modal-overlay" id="start-conversation-modal-overlay">
        <div class="modal" id="start-conversation-modal">
            <div class="modal-header">
                <h2>Start a New Conversation</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="start-conversation-form">
                    <div class="form-group">
                        <label for="conversation-recipient">Send a direct message to:</label>
                        <div class="select-wrapper">
                            <select id="conversation-recipient" required>
                                </select>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Start Chat</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MFA Setup Modal -->
    <div class="modal-overlay" id="mfa-modal-overlay">
        <div class="modal" id="mfa-setup-modal">
            <div class="modal-header">
                <h2>Set Up Multi-Factor Authentication</h2>
                <button class="close-modal-btn" id="close-mfa-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mfa-setup-steps">
                    <div class="mfa-step active" id="mfa-step-1">
                        <h3>Step 1: Download Authenticator App</h3>
                        <p>Download an authenticator app on your mobile device:</p>
                        <ul class="mfa-app-list">
                            <li>Google Authenticator</li>
                            <li>Microsoft Authenticator</li>
                            <li>Authy</li>
                        </ul>
                    </div>
                    <div class="mfa-step" id="mfa-step-2">
                        <h3>Step 2: Scan QR Code</h3>
                        <div class="qr-code-container">
                            <div class="qr-code-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </div>
                            <p class="mfa-secret-key">Secret Key: <code>ABCD-EFGH-IJKL-MNOP</code></p>
                        </div>
                    </div>
                    <div class="mfa-step" id="mfa-step-3">
                        <h3>Step 3: Enter Verification Code</h3>
                        <div class="form-group">
                            <label for="mfa-code">6-Digit Code</label>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.25M15.54 15.54l4.24 4.25M1 12h6M17 12h6M4.22 19.78l4.24-4.25M15.54 8.46l4.24-4.25"></path></svg>
                                <input type="text" id="mfa-code" placeholder="000000" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" autocomplete="off" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mfa-step-indicator">
                    <span class="step-dot active"></span>
                    <span class="step-dot"></span>
                    <span class="step-dot"></span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="mfa-prev-btn" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="mfa-next-btn">Next</button>
                <button class="btn btn-primary" id="mfa-finish-btn" style="display: none;">Enable MFA</button>
            </div>
        </div>
    </div>

    <!-- API Keys Setup Modal (First Login) -->
    <div class="modal-overlay" id="api-keys-setup-modal-overlay" style="z-index: 10000;">
        <div class="modal" id="api-keys-setup-modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Welcome! Set Up Your API Keys</h2>
                <button class="close-modal-btn" id="close-api-keys-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="api-keys-welcome">
                    <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                        To use the AI-powered features in MuseLink, you'll need to provide your own API keys. This ensures your usage and costs are under your control.
                    </p>

                    <div style="background: var(--card-bg); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid var(--accent-color);">
                        <h4 style="margin-top: 0; color: var(--accent-color);">Why do I need API keys?</h4>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <li style="margin-bottom: 0.5rem;">Your keys, your costs - You have full control over usage and billing</li>
                            <li style="margin-bottom: 0.5rem;">Enhanced security - Keys are double-encrypted and never shared</li>
                            <li style="margin-bottom: 0.5rem;">Better performance - Direct access to AI services without rate limits</li>
                        </ul>
                    </div>

                    <form id="api-keys-setup-form" class="settings-form">
                        <div class="form-group">
                            <label for="setup-gemini-api-key">
                                <strong>1. Google Gemini API Key</strong>
                                <a href="https://aistudio.google.com" target="_blank" rel="noopener noreferrer" style="margin-left: 0.5rem; color: var(--accent-color); text-decoration: none; font-size: 0.85rem;">
                                    Get Free API Key 
                                </a>
                            </label>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0.5rem;">
                                Free tier available with generous limits. Used for AI assistant and script analysis.
                            </p>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                <input type="password" id="setup-gemini-api-key" name="gemini_api_key" placeholder="Paste your Gemini API key here" autocomplete="off" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="setup-aimlapi-key">
                                <strong>2. AIMLAPI Key</strong>
                                <a href="https://aimlapi.com/" target="_blank" rel="noopener noreferrer" style="margin-left: 0.5rem; color: var(--accent-color); text-decoration: none; font-size: 0.85rem;">
                                    Get API Key 
                                </a>
                            </label>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0.5rem;">
                                Pay-as-you-go service. $20 credit recommended. Used for advanced script generation and voice synthesis.
                            </p>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                <input type="password" id="setup-aimlapi-key" name="aimlapi_key" placeholder="Paste your AIMLAPI key here" autocomplete="off" required>
                            </div>
                        </div>

                        <div style="background: var(--accent-color-subtle, rgba(124, 58, 237, 0.1)); padding: 0.75rem; border-radius: 6px; margin-top: 1rem; font-size: 0.85rem; color: var(--text-secondary);">
                            <svg style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                            <strong>Secure:</strong> Your API keys are encrypted with industry-standard AES-256-GCM and stored securely.
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="skip-api-keys-btn">Skip for Now</button>
                <button class="btn btn-primary" id="save-api-keys-btn">Save & Continue</button>
            </div>
        </div>
    </div>

    <!-- Share to Team Modal -->
    <div class="modal-overlay" id="share-modal-overlay">
        <div class="modal" id="share-modal">
            <div class="modal-header">
                <h2>Share with Team</h2>
                <button class="close-modal-btn" id="close-share-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="share-team-select">Select Team</label>
                    <select id="share-team-select" class="form-control">
                        <option value="">Choose a team...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="share-permission">Access Level</label>
                    <select id="share-permission" class="form-control">
                        <option value="read">Read Only - Team members can view and download</option>
                        <option value="write" selected>Full Access - Team members can view, download, and modify</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="share-message">Message (Optional)</label>
                    <textarea id="share-message" rows="3" placeholder="Add a note for your team..."></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-share-btn">Cancel</button>
                <button class="btn btn-primary" id="confirm-share-btn">Share</button>
            </div>
        </div>
    </div>

    <!-- Project Workspace Modal -->
    <div class="modal-overlay" id="project-workspace-overlay">
        <div class="modal modal-large" id="project-workspace-modal">
            <div class="modal-header">
                <div class="project-header-info">
                    <h2 id="project-workspace-title">Project Title</h2>
                    <span class="status-badge" id="project-workspace-status">draft</span>
                </div>
                <button class="close-modal-btn" id="close-project-workspace">&times;</button>
            </div>
            <div class="modal-body modal-body-workspace">
                <div class="workspace-layout">
                    <!-- Left Sidebar: Navigation -->
                    <div class="workspace-sidebar">
                        <nav class="workspace-nav">
                            <button class="workspace-nav-item active" data-workspace-tab="overview">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                Overview
                            </button>
                            <button class="workspace-nav-item" data-workspace-tab="timeline">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                                Timeline
                            </button>
                            <button class="workspace-nav-item" data-workspace-tab="tasks">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="9" y1="15" x2="15" y2="15"></line></svg>
                                Tasks
                            </button>
                            <button class="workspace-nav-item" data-workspace-tab="notes">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                Notes
                            </button>
                            <button class="workspace-nav-item" data-workspace-tab="chat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                Chat
                                <span class="notification-badge">3</span>
                            </button>
                            <button class="workspace-nav-item" data-workspace-tab="files">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                Files
                            </button>
                        </nav>
                    </div>

                    <!-- Main Content Area -->
                    <div class="workspace-content">
                        <!-- Overview Tab -->
                        <div class="workspace-tab-content active" id="workspace-overview">
                            <div class="workspace-section">
                                <h3>Project Description</h3>
                                <p id="project-description-text">Loading...</p>
                                <button class="btn btn-sm btn-secondary" id="edit-description-btn">Edit</button>
                            </div>
                            <div class="workspace-section">
                                <h3>Team Members</h3>
                                <div class="team-members-grid" id="project-team-members"></div>
                            </div>
                            <div class="workspace-section">
                                <h3>Quick Stats</h3>
                                <div class="quick-stats-grid">
                                    <div class="stat-item">
                                        <span class="stat-label">Tasks</span>
                                        <span class="stat-value" id="stat-tasks">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Completed</span>
                                        <span class="stat-value" id="stat-completed">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Notes</span>
                                        <span class="stat-value" id="stat-notes">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Files</span>
                                        <span class="stat-value" id="stat-files">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Tab -->
                        <div class="workspace-tab-content" id="workspace-timeline">
                            <div class="timeline-header">
                                <h3>Project Timeline</h3>
                                <button class="btn btn-sm btn-primary" id="add-timeline-event-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                    Add Event
                                </button>
                            </div>
                            <div class="timeline-container" id="project-timeline"></div>
                        </div>

                        <!-- Tasks Tab -->
                        <div class="workspace-tab-content" id="workspace-tasks">
                            <div class="tasks-header">
                                <h3>Task Board</h3>
                                <button class="btn btn-sm btn-primary" id="add-task-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                    New Task
                                </button>
                            </div>
                            <div class="task-board">
                                <div class="task-column">
                                    <h4>To Do <span class="task-count">0</span></h4>
                                    <div class="task-list" id="tasks-todo"></div>
                                </div>
                                <div class="task-column">
                                    <h4>In Progress <span class="task-count">0</span></h4>
                                    <div class="task-list" id="tasks-inprogress"></div>
                                </div>
                                <div class="task-column">
                                    <h4>Review <span class="task-count">0</span></h4>
                                    <div class="task-list" id="tasks-review"></div>
                                </div>
                                <div class="task-column">
                                    <h4>Done <span class="task-count">0</span></h4>
                                    <div class="task-list" id="tasks-done"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes Tab -->
                        <div class="workspace-tab-content" id="workspace-notes">
                            <div class="notes-header">
                                <h3>Project Notes</h3>
                                <button class="btn btn-sm btn-primary" id="add-note-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                    New Note
                                </button>
                            </div>
                            <div class="notes-grid" id="project-notes"></div>
                        </div>

                        <!-- Chat Tab -->
                        <div class="workspace-tab-content" id="workspace-chat">
                            <div class="chat-header-bar">
                                <h3>Team Chat</h3>
                                <button class="btn btn-primary" id="team-video-call-btn" onclick="showVideoCallComingSoon()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                                    Start Video Call
                                </button>
                            </div>
                            <div class="project-chat-container">
                                <div class="chat-messages-area" id="project-chat-messages"></div>
                                <div class="chat-input-container">
                                    <form id="project-chat-form">
                                        <input type="text" id="project-chat-input" placeholder="Type a message..." required>
                                        <button type="submit" class="btn btn-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Files Tab -->
                        <div class="workspace-tab-content" id="workspace-files">
                            <div class="files-header">
                                <h3>Project Files</h3>
                                <button class="btn btn-sm btn-primary" id="upload-project-file-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                                    Upload File
                                </button>
                            </div>
                            <div class="project-files-grid" id="project-files"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal-overlay" id="add-task-overlay">
        <div class="modal" id="add-task-modal">
            <div class="modal-header">
                <h2>Create New Task</h2>
                <button class="close-modal-btn" id="close-add-task">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-task-form">
                    <div class="form-group">
                        <label for="task-title">Task Title</label>
                        <input type="text" id="task-title" required>
                    </div>
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-assignee">Assign To</label>
                            <select id="task-assignee">
                                <option value="">Unassigned</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="task-priority">Priority</label>
                            <select id="task-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="task-due-date">Due Date</label>
                        <input type="date" id="task-due-date">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-add-task">Cancel</button>
                <button class="btn btn-primary" id="confirm-add-task">Create Task</button>
            </div>
        </div>
    </div>

    <!-- Video Conference Modal -->
    <!-- Encrypted Video Call Modal -->
    <div class="modal-overlay" id="video-call-overlay" style="display: none;">
        <div class="modal modal-large" id="video-call-modal">
            <div class="modal-header">
                <div class="video-call-header-info">
                    <h2 id="video-call-title">Encrypted Video Call</h2>
                    <span class="call-duration" id="call-duration">00:00</span>
                    <span class="encryption-indicator" id="encryption-indicator" style="display: none; color: #4ade80; margin-left: 1rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        DTLS-SRTP Encrypted
                    </span>
                </div>
                <button class="close-modal-btn" id="close-video-call">&times;</button>
            </div>
            <div class="modal-body modal-body-video">
                <div class="video-conference-container">
                    <!-- Main Video Area -->
                    <div class="video-main-area">
                        <div class="video-grid" id="video-grid">
                            <!-- Remote Video (large) -->
                            <div class="video-participant remote-video-container" id="remote-video-container" style="position: relative; width: 100%; height: 100%; background: #1a1a1a;">
                                <video id="remote-video" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                                <div class="video-placeholder" id="remote-video-placeholder" style="display: flex; align-items: center; justify-content: center; height: 100%;">
                                    <div class="avatar-large" id="remote-avatar">?</div>
                                    <div class="video-overlay">
                                        <span class="participant-name" id="remote-participant-name">Connecting...</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Local Video (small, picture-in-picture) -->
                            <div class="video-participant local-video-container" id="local-video-container" style="position: absolute; bottom: 20px; right: 20px; width: 200px; height: 150px; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 10;">
                                <video id="local-video" autoplay muted playsinline style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                                <div class="video-placeholder" id="local-video-placeholder" style="display: flex; align-items: center; justify-content: center; height: 100%; background: #2a2a2a;">
                                    <div class="avatar" id="local-avatar">You</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video Controls -->
                    <div class="video-controls">
                        <button class="video-control-btn" id="toggle-mic-btn" title="Mute/Unmute" data-muted="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <button class="video-control-btn" id="toggle-camera-btn" title="Start/Stop Video" data-video-off="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                        </button>
                        <button class="video-control-btn end-call-btn" id="end-call-btn" title="End Call">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                <line x1="23" y1="1" x2="1" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Incoming Call Modal -->
    <div class="modal-overlay" id="incoming-call-overlay" style="display: none;">
        <div class="modal" id="incoming-call-modal">
            <div class="modal-header">
                <h2>Incoming Call</h2>
            </div>
            <div class="modal-body" style="text-align: center; padding: 2rem;">
                <div class="avatar-large" style="margin: 0 auto 1rem auto;" id="incoming-call-avatar">?</div>
                <h3 id="incoming-call-name" style="margin-bottom: 0.5rem;">Unknown</h3>
                <p id="incoming-call-type" style="color: #999; margin-bottom: 2rem;">Video Call</p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-secondary" id="reject-call-btn" style="background: #ff6b6b;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            <line x1="23" y1="1" x2="1" y2="23"></line>
                        </svg>
                        Decline
                    </button>
                    <button class="btn btn-primary" id="accept-call-btn" style="background: #4ade80;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        Accept
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Generation Progress Modal -->
    <div class="modal-overlay" id="video-progress-modal-overlay" style="display: none;">
        <div class="modal" id="video-progress-modal">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    Generating Video
                </h2>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <div id="video-generating-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div class="spinner" id="video-spinner" style="margin: 0 auto 1.5rem auto; width: 60px; height: 60px; border: 4px solid rgba(var(--primary-rgb), 0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p id="video-status-text" style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--text-primary);">Starting video generation...</p>
                        <p id="video-status-subtext" style="color: var(--text-secondary); font-size: 0.9rem;">This may take 60-90 seconds</p>
                    </div>

                    <div class="progress-container" style="margin: 2rem 0;">
                        <div class="progress-bar-bg" style="background: rgba(var(--primary-rgb), 0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div class="progress-bar-fill" id="video-progress-bar" style="background: linear-gradient(90deg, var(--primary), var(--accent)); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">Progress</span>
                            <span id="video-progress-percent" style="font-size: 0.85rem; color: var(--text-secondary); font-weight: 600;">0%</span>
                        </div>
                    </div>
                </div>

                <div id="video-success-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Video Generated Successfully!</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Your video has been saved to My Ideas</p>
                    <button class="btn btn-primary" onclick="closeVideoModal(); loadMyIdeas();">
                        View in My Ideas
                    </button>
                </div>

                <div id="video-error-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--error); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Video Generation Failed</h3>
                    <p id="video-error-message" style="color: var(--text-secondary); margin-bottom: 1.5rem;">An error occurred. Please try again.</p>
                    <button class="btn btn-secondary" onclick="closeVideoModal();">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Generation Progress Modal -->
    <div class="modal-overlay" id="image-progress-modal-overlay" style="display: none;">
        <div class="modal" id="image-progress-modal" style="max-width: 800px;">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    Generating Image
                </h2>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <div id="image-generating-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div class="spinner" style="margin: 0 auto 1.5rem auto; width: 60px; height: 60px; border: 4px solid rgba(var(--primary-rgb), 0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--text-primary);">Creating your image...</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">This may take a few moments</p>
                    </div>
                </div>

                <div id="image-success-content" style="display: none;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <h3 style="margin-bottom: 0.5rem;">Image Generated Successfully!</h3>
                    </div>
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <img id="image-preview" src="" alt="Generated Image" style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    </div>
                    <div style="display: flex; gap: 0.75rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closeImageModal();">Close</button>
                        <button class="btn btn-primary" onclick="closeImageModal(); loadMyIdeas();">
                            View in My Ideas
                        </button>
                    </div>
                </div>

                <div id="image-error-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--error); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Image Generation Failed</h3>
                    <p id="image-error-message" style="color: var(--text-secondary); margin-bottom: 1.5rem;">An error occurred. Please try again.</p>
                    <button class="btn btn-secondary" onclick="closeImageModal();">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Generation Progress Modal -->
    <div class="modal-overlay" id="voice-progress-modal-overlay" style="display: none;">
        <div class="modal" id="voice-progress-modal">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                    Generating Voice
                </h2>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <div id="voice-generating-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div class="spinner" style="margin: 0 auto 1.5rem auto; width: 60px; height: 60px; border: 4px solid rgba(var(--primary-rgb), 0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--text-primary);">Creating your voice...</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">This may take a few moments</p>
                    </div>
                </div>

                <div id="voice-success-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Voice Generated Successfully!</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Your voice has been saved to My Ideas</p>
                    <button class="btn btn-primary" onclick="closeVoiceModal(); loadMyIdeas();">
                        View in My Ideas
                    </button>
                </div>

                <div id="voice-error-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--error); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Voice Generation Failed</h3>
                    <p id="voice-error-message" style="color: var(--text-secondary); margin-bottom: 1.5rem;">An error occurred. Please try again.</p>
                    <button class="btn btn-secondary" onclick="closeVoiceModal();">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Script Generation Progress Modal -->
    <div class="modal-overlay" id="script-progress-modal-overlay" style="display: none;">
        <div class="modal" id="script-progress-modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    Generating Script
                </h2>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <div id="script-generating-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div class="spinner" style="margin: 0 auto 1.5rem auto; width: 60px; height: 60px; border: 4px solid rgba(var(--primary-rgb), 0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--text-primary);">Crafting your script...</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">This may take a few moments</p>
                    </div>
                </div>

                <div id="script-success-content" style="display: none;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <h3 style="margin-bottom: 0.5rem;">Script Generated Successfully!</h3>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); max-height: 400px; overflow-y: auto; text-align: left;">
                        <pre id="script-preview" style="white-space: pre-wrap; word-wrap: break-word; margin: 0; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6;"></pre>
                    </div>
                    <div style="display: flex; gap: 0.75rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closeScriptModal();">Close</button>
                        <button class="btn btn-primary" onclick="closeScriptModal(); loadMyIdeas();">
                            View in My Ideas
                        </button>
                    </div>
                </div>

                <div id="script-error-content" style="display: none; text-align: center;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: var(--error); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Script Generation Failed</h3>
                    <p id="script-error-message" style="color: var(--text-secondary); margin-bottom: 1.5rem;">An error occurred. Please try again.</p>
                    <button class="btn btn-secondary" onclick="closeScriptModal();">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Clear all session data on logout
        function clearSessionData() {
            // Clear localStorage
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.clear();

            // Clear sessionStorage
            sessionStorage.clear();

            // Clear all cookies
            document.cookie.split(";").forEach(function(c) {
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });

            return true; // Allow navigation to continue
        }

        // Video call feature coming soon message
        function showVideoCallComingSoon() {
            // Create flash message
            const flashContainer = document.getElementById('flash-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flash-message flash-info';
            messageDiv.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <span>Video calling feature will be fixed in the next release. Stay tuned!</span>
            `;

            flashContainer.appendChild(messageDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(() => messageDiv.remove(), 300);
            }, 5000);
        }

        // Navigate to My Ideas page
        function loadMyIdeas() {
            // Find the My Ideas nav item and simulate a click
            const myIdeasNavItem = document.querySelector('[data-page="my-ideas-page"]');
            if (myIdeasNavItem) {
                myIdeasNavItem.click();
            } else {
                // Fallback: manually show the page
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none';
                });

                // Show My Ideas page
                const myIdeasPage = document.getElementById('my-ideas-page');
                if (myIdeasPage) {
                    myIdeasPage.classList.add('active');
                    myIdeasPage.style.display = 'block';
                }

                // Update nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                if (myIdeasNavItem) {
                    myIdeasNavItem.classList.add('active');
                }
            }
        }

        // ============================================================================
        // API Keys Management
        // ============================================================================

        // Check API keys status and show modal if needed
        async function checkApiKeysStatus() {
            try {
                const response = await fetch('/api/v1/user/settings/api-keys/status', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update status indicators in settings page
                    updateApiKeyStatusUI(data.api_keys);

                    // Show first-login modal if user doesn't have both keys
                    if (!data.has_all_keys && !localStorage.getItem('api_keys_setup_skipped')) {
                        showApiKeysSetupModal();
                    }
                }
            } catch (error) {
                console.error('Error checking API keys status:', error);
            }
        }

        // Update API key status UI
        function updateApiKeyStatusUI(apiKeys) {
            const geminiStatus = document.getElementById('gemini-status');
            const aimlStatus = document.getElementById('aimlapi-status');
            const geminiIcon = document.getElementById('gemini-status-icon');
            const aimlIcon = document.getElementById('aimlapi-status-icon');

            if (geminiStatus && geminiIcon) {
                if (apiKeys.gemini) {
                    geminiStatus.textContent = 'Configured ';
                    geminiStatus.style.color = 'var(--success-color, #10b981)';
                    geminiIcon.style.color = 'var(--success-color, #10b981)';
                } else {
                    geminiStatus.textContent = 'Not configured';
                    geminiStatus.style.color = 'var(--text-secondary)';
                    geminiIcon.style.color = 'var(--text-secondary)';
                }
            }

            if (aimlStatus && aimlIcon) {
                if (apiKeys.aimlapi) {
                    aimlStatus.textContent = 'Configured ';
                    aimlStatus.style.color = 'var(--success-color, #10b981)';
                    aimlIcon.style.color = 'var(--success-color, #10b981)';
                } else {
                    aimlStatus.textContent = 'Not configured';
                    aimlStatus.style.color = 'var(--text-secondary)';
                    aimlIcon.style.color = 'var(--text-secondary)';
                }
            }
        }

        // Show API keys setup modal
        function showApiKeysSetupModal() {
            const modal = document.getElementById('api-keys-setup-modal-overlay');
            if (modal) {
                modal.classList.add('is-active');
            }
        }

        // Hide API keys setup modal
        function hideApiKeysSetupModal() {
            const modal = document.getElementById('api-keys-setup-modal-overlay');
            if (modal) {
                modal.classList.remove('is-active');
            }
        }

        // Helper to get CSRF token from cookie
        function getCSRFToken() {
            const csrfCookie = document.cookie.split('; ').find(row => row.startsWith('csrf_token='));
            return csrfCookie ? csrfCookie.split('=')[1] : null;
        }

        // Save API keys (from settings form)
        async function saveApiKeys(geminiKey, aimlKey) {
            try {
                const csrfToken = getCSRFToken();

                const response = await fetch('/api/v1/user/settings/api-keys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': csrfToken
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        gemini_api_key: geminiKey || null,
                        aimlapi_key: aimlKey || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showFlashMessage('success', data.message || 'API keys saved successfully!');
                    // Refresh status
                    await checkApiKeysStatus();
                    return true;
                } else {
                    showFlashMessage('error', data.detail || 'Failed to save API keys');
                    return false;
                }
            } catch (error) {
                console.error('Error saving API keys:', error);
                showFlashMessage('error', 'Failed to save API keys. Please try again.');
                return false;
            }
        }

        // Initialize API keys functionality on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check API keys status
            checkApiKeysStatus();

            // Settings page API keys form handler
            const apiKeysForm = document.getElementById('api-keys-form');
            if (apiKeysForm) {
                apiKeysForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const geminiKey = document.getElementById('gemini-api-key').value.trim();
                    const aimlKey = document.getElementById('aimlapi-key').value.trim();

                    if (!geminiKey && !aimlKey) {
                        showFlashMessage('error', 'Please enter at least one API key');
                        return;
                    }

                    const success = await saveApiKeys(geminiKey, aimlKey);
                    if (success) {
                        // Clear form fields for security
                        document.getElementById('gemini-api-key').value = '';
                        document.getElementById('aimlapi-key').value = '';
                    }
                });
            }

            // First-login modal form handler
            const setupForm = document.getElementById('api-keys-setup-form');
            const saveBtn = document.getElementById('save-api-keys-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', async function(e) {
                    e.preventDefault();

                    const geminiKey = document.getElementById('setup-gemini-api-key').value.trim();
                    const aimlKey = document.getElementById('setup-aimlapi-key').value.trim();

                    if (!geminiKey || !aimlKey) {
                        showFlashMessage('error', 'Please enter both API keys');
                        return;
                    }

                    const success = await saveApiKeys(geminiKey, aimlKey);
                    if (success) {
                        hideApiKeysSetupModal();
                        showFlashMessage('success', 'API keys configured successfully! You can now use all AI features.');
                    }
                });
            }

            // Skip button handler
            const skipBtn = document.getElementById('skip-api-keys-btn');
            if (skipBtn) {
                skipBtn.addEventListener('click', function() {
                    localStorage.setItem('api_keys_setup_skipped', 'true');
                    hideApiKeysSetupModal();
                    showFlashMessage('info', 'You can configure your API keys later in Settings');
                });
            }

            // Close modal button handler
            const closeBtn = document.getElementById('close-api-keys-modal');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    hideApiKeysSetupModal();
                });
            }
        });
    </script>
    <script src="/static/js/user-dashboard.js?v=1762826000"></script>

    <!-- Assign to Team Modal -->
    <div class="modal-overlay" id="assign-team-modal-overlay">
        <div class="modal" id="assign-team-modal">
            <div class="modal-header">
                <h2>Assign Idea to Team</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: #64748b; margin-bottom: 1.5rem;">Select a team to collaborate on this idea. You must be a member of the team to assign ideas to it.</p>

                <div id="assign-team-loading" style="text-align: center; padding: 2rem; display: none;">
                    <div class="spinner"></div>
                    <p style="color: #64748b; margin-top: 1rem;">Loading your teams...</p>
                </div>

                <div id="assign-team-content">
                    <div class="form-group">
                        <label for="assign-team-select">Select Team</label>
                        <select id="assign-team-select" class="form-control">
                            <option value="">-- Select a Team --</option>
                        </select>
                    </div>

                    <div id="assign-team-info" style="display: none; background: var(--surface); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 3px solid #3b82f6;">
                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 0.125rem;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <div>
                                <strong style="color: var(--text); display: block; margin-bottom: 0.25rem;">About Team Assignment</strong>
                                <p style="color: #64748b; font-size: 0.9rem; margin: 0;">Once assigned, all team members will be able to view and collaborate on this idea.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="assign-team-error" class="error-message" style="display: none; margin-top: 1rem;"></div>
                <div id="assign-team-success" class="success-message" style="display: none; margin-top: 1rem;"></div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirm-assign-team-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <polyline points="17 11 19 13 23 9"></polyline>
                    </svg>
                    Assign to Team
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="delete-idea-modal-overlay">
        <div class="modal" id="delete-idea-modal">
            <div class="modal-header">
                <h2>Delete Idea?</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 3px solid #ef4444;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 0.125rem;">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <div>
                            <strong style="color: var(--text); display: block; margin-bottom: 0.5rem;">This action cannot be undone</strong>
                            <p style="color: #64748b; font-size: 0.9rem; margin: 0;">The idea "<strong id="delete-idea-title">Untitled</strong>" will be permanently deleted from the database. All associated data, including team assignments and version history, will be removed.</p>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="confirm-delete-checkbox" style="width: 18px; height: 18px;">
                        <span style="color: var(--text);">I understand this action is permanent</span>
                    </label>
                </div>

                <div id="delete-idea-error" class="error-message" style="display: none;"></div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                <button type="button" class="btn" id="confirm-delete-idea-btn" disabled style="background: #ef4444; color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete Permanently
                </button>
            </div>
        </div>
    </div>

    <!-- Team Invitation Modal -->
    <div id="inviteTeamModal" class="team-modal" style="display: none;">
        <div class="team-modal-content">
            <span class="team-modal-close" onclick="closeInviteModal()">&times;</span>
            <h2>Invite User to Team</h2>
            <div id="inviteForm">
                <div class="form-group">
                    <label for="inviteUsername">Username:</label>
                    <input type="text" id="inviteUsername" placeholder="Enter username" maxlength="100" required>
                    <small>Enter the exact username of the user you want to invite</small>
                </div>
                <div class="form-group">
                    <label for="inviteMessage">Optional Message:</label>
                    <textarea id="inviteMessage" placeholder="Add a personal message (optional)" maxlength="500" rows="3"></textarea>
                </div>
                <div id="inviteError" class="error-message" style="display: none;"></div>
                <div id="inviteSuccess" class="success-message" style="display: none;"></div>
                <div class="button-group">
                    <button onclick="sendTeamInvitation()" class="btn btn-primary">Send Invitation</button>
                    <button onclick="closeInviteModal()" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Bell -->
    <div id="notificationBell" class="notification-bell" onclick="toggleNotifications()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
    </div>

    <div id="notificationDropdown" class="notification-dropdown" style="display: none;">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button onclick="markAllAsRead()" class="btn-link">Mark all as read</button>
        </div>
        <div id="notificationList" class="notification-list">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <style>
        /* Team Modal Styles */
        .team-modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .team-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        [data-theme="light"] .team-modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .team-modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .team-modal-close:hover {
            color: #fff;
        }

        [data-theme="light"] .team-modal-close:hover {
            color: #000;
        }

        .team-modal h2 {
            margin-top: 0;
            color: #fff;
            font-size: 24px;
        }

        [data-theme="light"] .team-modal h2 {
            color: #1a1a1a;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e0e0;
        }

        [data-theme="light"] .form-group label {
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transition: all 0.3s;
        }

        [data-theme="light"] .form-group input,
        [data-theme="light"] .form-group textarea {
            background: #fff;
            border: 1px solid #ddd;
            color: #333;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #999;
            font-size: 12px;
        }

        .error-message {
            color: #ff6b6b;
            background-color: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .success-message {
            color: #51cf66;
            background-color: rgba(81, 207, 102, 0.1);
            border: 1px solid rgba(81, 207, 102, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Notification Bell */
        .notification-bell {
            position: fixed;
            top: 20px;
            right: 20px;
            cursor: pointer;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            z-index: 9999;
            transition: all 0.3s;
        }

        .notification-bell:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .notification-bell svg {
            display: block;
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
        }

        .notification-dropdown {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 400px;
            max-width: calc(100vw - 40px);
            max-height: 500px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 9998;
            overflow: hidden;
        }

        [data-theme="light"] .notification-dropdown {
            background: white;
            border: 1px solid #e0e0e0;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] .notification-header {
            border-bottom: 1px solid #e0e0e0;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }

        [data-theme="light"] .notification-header h3 {
            color: #1a1a1a;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 13px;
            padding: 0;
        }

        .btn-link:hover {
            text-decoration: underline;
        }

        .notification-list {
            max-height: 420px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        [data-theme="light"] .notification-item {
            border-bottom: 1px solid #f0f0f0;
        }

        .notification-item:hover {
            background-color: rgba(124, 58, 237, 0.1);
        }

        .notification-item.unread {
            background-color: rgba(124, 58, 237, 0.15);
        }

        [data-theme="light"] .notification-item.unread {
            background-color: rgba(124, 58, 237, 0.05);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #fff;
        }

        [data-theme="light"] .notification-title {
            color: #1a1a1a;
        }

        .notification-message {
            font-size: 14px;
            color: #b0b0b0;
            margin-bottom: 4px;
        }

        [data-theme="light"] .notification-message {
            color: #666;
        }

        .notification-time {
            font-size: 12px;
            color: #888;
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .team-section {
            margin-bottom: 30px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        [data-theme="light"] .team-section {
            background: rgba(0, 0, 0, 0.02);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .team-section h3 {
            margin-bottom: 16px;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .team-ideas-container {
            margin-bottom: 30px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] .team-ideas-container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .team-ideas-container h3 {
            margin-bottom: 16px;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .team-members-list {
            list-style: none;
        }

        .team-member-item {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            padding: 24px 32px !important;
            background: rgba(255, 255, 255, 0.08) !important;
            border-radius: 10px !important;
            margin-bottom: 12px !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            transition: all 0.2s ease;
        }

        .team-member-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="light"] .team-member-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }

        [data-theme="light"] .team-member-item:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .member-info {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .member-info > span:first-child {
            font-weight: 500;
            font-size: 0.95rem;
        }

        .member-role-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .member-role-badge.owner {
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            color: white;
        }

        .member-role-badge.admin {
            background: linear-gradient(135deg, #ffd43b, #ffd43b);
            color: #000;
        }

        .member-role-badge.member {
            background: linear-gradient(135deg, #51cf66, #51cf66);
            color: white;
        }

        .btn-remove-member {
            padding: 6px 12px;
            background: rgba(255, 107, 107, 0.1);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn-remove-member:hover {
            background: rgba(255, 107, 107, 0.2);
        }

        /* Delete Team Confirmation Modal */
        .delete-confirm-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
            z-index: 10000;
            place-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .delete-confirm-overlay.active {
            display: grid;
            opacity: 1;
        }

        .delete-confirm-modal {
            background: var(--card-bg);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .delete-confirm-overlay.active .delete-confirm-modal {
            transform: scale(1);
            opacity: 1;
        }

        .delete-confirm-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .delete-confirm-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .delete-confirm-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .delete-confirm-warning {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .delete-confirm-warning h4 {
            color: #ff6b6b;
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .delete-confirm-warning ul {
            margin: 0;
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }

        .delete-confirm-warning li {
            margin-bottom: 0.25rem;
        }

        .delete-confirm-message {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .delete-confirm-message p {
            margin: 0;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .delete-confirm-input-group {
            margin-bottom: 1.5rem;
        }

        .delete-confirm-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .delete-confirm-input-group .team-name-display {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 4px;
            color: var(--primary-color);
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .delete-confirm-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }

        .delete-confirm-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .delete-confirm-input.match {
            border-color: #51cf66;
        }

        .delete-confirm-input.no-match {
            border-color: #ff6b6b;
        }

        .delete-confirm-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .delete-confirm-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .delete-confirm-btn.cancel {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .delete-confirm-btn.cancel:hover {
            background: var(--hover-bg);
        }

        .delete-confirm-btn.delete {
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .delete-confirm-btn.delete.enabled {
            opacity: 1;
            cursor: pointer;
        }

        .delete-confirm-btn.delete.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .delete-confirm-btn.delete:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>

    <!-- Delete Team Confirmation Modal -->
    <div id="delete-team-modal-overlay" class="delete-confirm-overlay">
        <div class="delete-confirm-modal">
            <div class="delete-confirm-header">
                <div class="delete-confirm-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <h2 class="delete-confirm-title">Delete Team</h2>
            </div>

            <div class="delete-confirm-warning">
                <h4> Warning: This action cannot be undone</h4>
                <ul>
                    <li>All team members will be removed</li>
                    <li>Team files will become inaccessible</li>
                    <li>All team data will be permanently deleted</li>
                </ul>
            </div>

            <div class="delete-confirm-input-group">
                <label>
                    Type <span class="team-name-display" id="delete-team-name-display"></span> to confirm:
                </label>
                <input
                    type="text"
                    id="delete-team-name-input"
                    class="delete-confirm-input"
                    placeholder="Enter team name exactly"
                    autocomplete="off"
                />
            </div>

            <div class="delete-confirm-actions">
                <button class="delete-confirm-btn cancel" onclick="closeDeleteTeamModal()">
                    Cancel
                </button>
                <button class="delete-confirm-btn delete" id="confirm-delete-team-btn" disabled>
                    Delete Team
                </button>
            </div>
        </div>
    </div>

    <!-- Delete File/Item Confirmation Modal -->
    <div id="delete-file-modal-overlay" class="delete-confirm-overlay">
        <div class="delete-confirm-modal">
            <div class="delete-confirm-header">
                <div class="delete-confirm-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </div>
                <h2 class="delete-confirm-title" id="delete-file-title">Delete File</h2>
            </div>

            <div class="delete-confirm-message">
                <p id="delete-file-message">Are you sure you want to delete this item? This action cannot be undone.</p>
            </div>

            <div class="delete-confirm-actions">
                <button class="delete-confirm-btn cancel" onclick="closeDeleteFileModal()">
                    Cancel
                </button>
                <button class="delete-confirm-btn delete" id="confirm-delete-file-btn">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <button id="ai-assistant-btn" class="ai-assistant-fab" title="AI Assistant">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            <circle cx="9" cy="10" r="1"></circle>
            <circle cx="15" cy="10" r="1"></circle>
            <path d="M9 14s1.5 1.5 3 1.5 3-1.5 3-1.5"></path>
        </svg>
    </button>

    <!-- AI Assistant Modal -->
    <div id="ai-assistant-modal" class="ai-modal">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <div class="ai-modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    <span>AI Assistant</span>
                    <span class="ai-badge">Gemini 2.5 Pro</span>
                </div>
                <button class="ai-modal-close" id="close-ai-modal">&times;</button>
            </div>

            <div class="ai-modal-body">
                <div id="ai-chat-messages" class="ai-chat-messages">
                    <div class="ai-message ai-message-assistant">
                        <div class="ai-message-avatar">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <div class="ai-message-content">
                            <p>Hello! I'm your AI creative assistant. I can help you with:</p>
                            <ul class="ai-features-list">
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
                                        <polyline points="17 2 12 7 7 2"></polyline>
                                    </svg>
                                    Brainstorming screenplay ideas
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    Analyzing your scripts
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    Reviewing your generated images
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    Creating flowcharts from descriptions
                                </li>
                                <li>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                    Providing creative feedback
                                </li>
                            </ul>
                            <p>What would you like to work on today?</p>
                        </div>
                    </div>
                </div>

                <div class="ai-quick-actions">
                    <button class="ai-quick-btn" data-action="analyze">Analyze My Latest Script</button>
                    <button class="ai-quick-btn" data-action="brainstorm">Brainstorm Ideas</button>
                    <button class="ai-quick-btn" data-action="flowchart">Create Flowchart</button>
                </div>

                <div class="ai-chat-input-container">
                    <div class="ai-chat-input-wrapper">
                        <textarea
                            id="ai-chat-input"
                            class="ai-chat-input"
                            placeholder="Ask me anything about your creative projects..."
                            rows="1"
                        ></textarea>
                        <button id="ai-send-btn" class="ai-send-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                    <div class="ai-status" id="ai-status"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* AI Assistant Styles */
        .ai-assistant-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-assistant-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .ai-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s;
        }

        .ai-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-modal-content {
            background: linear-gradient(180deg, #1a1625 0%, #0f0d1a 100%);
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3), 0 0 0 1px rgba(102, 126, 234, 0.2);
            animation: slideUp 0.3s;
        }

        .ai-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .ai-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #e8e6f0;
        }

        .ai-modal-title svg {
            color: #a78bfa;
        }

        .ai-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ai-modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #8b7fa8;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .ai-modal-close:hover {
            background: rgba(102, 126, 234, 0.2);
            color: #a78bfa;
        }

        .ai-modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Custom scrollbar for dark theme */
        .ai-chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .ai-chat-messages::-webkit-scrollbar-track {
            background: rgba(30, 27, 40, 0.4);
            border-radius: 4px;
        }

        .ai-chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }

        .ai-chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #7c8ef5 0%, #8b5bb5 100%);
        }

        .ai-message {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .ai-message-user {
            flex-direction: row-reverse;
        }

        .ai-message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .ai-message-assistant .ai-message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .ai-message-user .ai-message-avatar {
            background: rgba(167, 139, 250, 0.2);
            color: #a78bfa;
            border: 1px solid rgba(167, 139, 250, 0.3);
        }

        .ai-message-content {
            background: rgba(30, 27, 40, 0.6);
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 70%;
            line-height: 1.6;
            color: #d4d1e0;
            border: 1px solid rgba(102, 126, 234, 0.15);
        }

        .ai-message-user .ai-message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .ai-message-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .ai-message-content li {
            margin: 4px 0;
        }

        /* Professional icon list styling */
        .ai-features-list {
            list-style: none;
            padding-left: 0 !important;
            margin: 16px 0;
        }

        .ai-features-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            margin: 0;
        }

        .ai-features-list li svg {
            color: #a78bfa;
            flex-shrink: 0;
            opacity: 0.9;
        }

        /* Priority badges for analysis results */
        .priority-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-right: 6px;
        }

        .priority-high {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .priority-medium {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%);
            color: #fcd34d;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .priority-low {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 163, 74, 0.2) 100%);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .ai-quick-actions {
            display: flex;
            gap: 8px;
            padding: 0 24px 12px;
            flex-wrap: wrap;
        }

        .ai-quick-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            color: #a78bfa;
        }

        .ai-quick-btn:hover {
            border-color: #667eea;
            color: #fff;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .ai-chat-input-container {
            padding: 16px 24px 20px;
            border-top: 1px solid rgba(102, 126, 234, 0.2);
            background: linear-gradient(180deg, transparent 0%, rgba(15, 13, 26, 0.5) 100%);
        }

        .ai-chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .ai-chat-input {
            flex: 1;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            resize: none;
            max-height: 120px;
            font-family: inherit;
            background: rgba(30, 27, 40, 0.6);
            color: #e8e6f0;
        }

        .ai-chat-input::placeholder {
            color: #8b7fa8;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(30, 27, 40, 0.8);
        }

        .ai-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .ai-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-send-btn:not(:disabled):hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .ai-status {
            margin-top: 8px;
            font-size: 12px;
            color: #8b7fa8;
            min-height: 18px;
        }

        .ai-status.typing {
            color: #a78bfa;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-loading {
            display: inline-flex;
            gap: 4px;
        }

        .ai-loading span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            animation: bounce 1.4s infinite;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
        }

        .ai-loading span:nth-child(2) { animation-delay: 0.2s; }
        .ai-loading span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
        }

        @media (max-width: 768px) {
            .ai-modal-content {
                width: 95%;
                max-height: 90vh;
            }

            .ai-assistant-fab {
                bottom: 20px;
                right: 20px;
                width: 56px;
                height: 56px;
            }
        }
    </style>

    <script src="/static/js/video-api-client.js?v=20251020e"></script>
    <script src="/static/js/secure-video-call.js?v=20251020d"></script>
    <script src="/static/js/teams.js?v=20251020d"></script>
    <script src="/static/js/messages.js?v=20251020d"></script>
    <script src="/static/js/flowchart.js?v=20251116i"></script>
    <script src="/static/js/flowchart-dashboard.js?v=20251116h"></script>
    <script src="/static/js/ai-assistant.js?v=20251116"></script>
    <script src="/static/js/ai-planner.js?v=20251116f"></script>
</body>

</html>